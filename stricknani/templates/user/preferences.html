{% extends "base.html" %}

{% block title %}{{ _('User Preferences') }} - Stricknani{% endblock %}

{% block content %}
<section class="space-y-6">
    <header class="border-b border-slate-200 pb-4 dark:border-slate-700">
        <h1 class="text-3xl font-semibold text-slate-900 dark:text-slate-100 flex items-center gap-2">
            <span class="mdi mdi-account-cog-outline text-blue-600 dark:text-blue-400"></span>
            {{ _('User Preferences') }}
        </h1>
        <p class="mt-2 text-slate-600 dark:text-slate-300 max-w-2xl">
            {{ _('Control how Stricknani looks and feels for your account.') }}
        </p>
    </header>

    <div class="grid gap-6 xl:grid-cols-3">
        <article class="rounded-xl border border-slate-200 bg-white/80 p-6 shadow-sm transition-colors dark:border-slate-700 dark:bg-slate-900/70">
            <h2 class="text-xl font-semibold text-slate-900 dark:text-slate-100 flex items-center gap-2">
                <span class="mdi mdi-account-circle-outline text-blue-600 dark:text-blue-400"></span>
                {{ _('Profile image') }}
            </h2>
            <p class="mt-2 text-sm text-slate-600 dark:text-slate-300">
                {{ _('Upload a friendly face so it is easier to recognize your projects at a glance.') }}
            </p>
            <div class="mt-6" id="profile-avatar-container">
                {% include "user/_profile_avatar.html" %}
            </div>
            <form
                class="mt-4 space-y-3"
                hx-post="/user/profile-image"
                hx-target="#profile-avatar-container [data-profile-avatar]"
                hx-swap="outerHTML"
                hx-encoding="multipart/form-data"
                hx-on::after-request="if (event.detail.successful) { showToast('{{ _('Profile image updated successfully!') }}', 'success'); this.reset(); }"
            >
                <label class="block text-sm font-medium text-slate-700 dark:text-slate-200" for="profile-image">
                    {{ _('Select an image') }}
                </label>
                <input
                    id="profile-image"
                    name="file"
                    type="file"
                    accept="image/*"
                    class="block w-full text-sm text-slate-600 file:mr-4 file:rounded-md file:border-0 file:bg-blue-50 file:px-4 file:py-2 file:text-blue-700 hover:file:bg-blue-100 focus:outline-none dark:text-slate-200 dark:file:bg-blue-400/10 dark:file:text-blue-200 dark:hover:file:bg-blue-400/20"
                    required
                >
                <button
                    type="submit"
                    class="inline-flex items-center gap-2 rounded-md bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm transition hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 dark:hover:bg-blue-500"
                >
                    <span class="mdi mdi-upload"></span>
                    {{ _('Upload') }}
                </button>
            </form>
        </article>
        <article class="rounded-xl border border-slate-200 bg-white/80 p-6 shadow-sm transition-colors dark:border-slate-700 dark:bg-slate-900/70 xl:col-span-2">
            <h2 class="text-xl font-semibold text-slate-900 dark:text-slate-100 flex items-center gap-2">
                <span class="mdi mdi-theme-light-dark text-blue-600 dark:text-blue-400"></span>
                {{ _('Theme') }}
            </h2>
            <p class="mt-2 text-sm text-slate-600 dark:text-slate-300">
                {{ _('Choose whether Stricknani follows your device setting or sticks to light or dark mode.') }}
            </p>
            <div class="mt-6 grid gap-3 sm:grid-cols-3">
                <button
                    type="button"
                    data-theme-option="light"
                    data-theme-active-class="border-blue-500 bg-blue-50 text-blue-700 dark:border-blue-400 dark:bg-slate-700 dark:text-blue-100"
                    data-theme-inactive-class="border-transparent bg-slate-100 text-slate-900 dark:bg-slate-800 dark:text-slate-100"
                    class="flex flex-col items-center gap-2 rounded-lg border border-transparent bg-slate-100 px-4 py-3 text-sm font-medium text-slate-900 transition hover:border-blue-400 hover:bg-slate-200 focus:outline-none dark:bg-slate-800 dark:text-slate-100 dark:hover:bg-slate-700"
                    aria-pressed="false"
                >
                    <span class="mdi mdi-white-balance-sunny text-2xl text-amber-500"></span>
                    {{ _('Light') }}
                </button>
                <button
                    type="button"
                    data-theme-option="dark"
                    data-theme-active-class="border-blue-500 bg-blue-50 text-blue-700 dark:border-blue-400 dark:bg-slate-700 dark:text-blue-100"
                    data-theme-inactive-class="border-transparent bg-slate-100 text-slate-900 dark:bg-slate-800 dark:text-slate-100"
                    class="flex flex-col items-center gap-2 rounded-lg border border-transparent bg-slate-100 px-4 py-3 text-sm font-medium text-slate-900 transition hover:border-blue-400 hover:bg-slate-200 focus:outline-none dark:bg-slate-800 dark:text-slate-100 dark:hover:bg-slate-700"
                    aria-pressed="false"
                >
                    <span class="mdi mdi-weather-night text-2xl text-blue-400"></span>
                    {{ _('Dark') }}
                </button>
                <button
                    type="button"
                    data-theme-option="system"
                    data-theme-active-class="border-blue-500 bg-blue-50 text-blue-700 dark:border-blue-400 dark:bg-slate-700 dark:text-blue-100"
                    data-theme-inactive-class="border-transparent bg-slate-100 text-slate-900 dark:bg-slate-800 dark:text-slate-100"
                    class="flex flex-col items-center gap-2 rounded-lg border border-transparent bg-slate-100 px-4 py-3 text-sm font-medium text-slate-900 transition hover:border-blue-400 hover:bg-slate-200 focus:outline-none dark:bg-slate-800 dark:text-slate-100 dark:hover:bg-slate-700"
                    aria-pressed="false"
                >
                    <span class="mdi mdi-monitor text-2xl text-emerald-500"></span>
                    {{ _('System') }}
                </button>
            </div>
            <p class="mt-4 text-xs text-slate-500 dark:text-slate-400">
                {{ _('Your selection is stored locally in this browser.') }}
            </p>
        </article>
    </div>

    <article class="rounded-xl border border-slate-200 bg-white/80 p-6 shadow-sm transition-colors dark:border-slate-700 dark:bg-slate-900/70">
        <h2 class="text-xl font-semibold text-slate-900 dark:text-slate-100 flex items-center gap-2">
            <span class="mdi mdi-theme-light-dark text-blue-600 dark:text-blue-400"></span>
            {{ _('Preview') }}
        </h2>
        <p class="mt-2 text-sm text-slate-600 dark:text-slate-300">
            {{ _('This preview updates to reflect your current theme choice.') }}
        </p>
        <div
            class="mt-6 rounded-lg border border-dashed border-slate-300 bg-slate-100 p-6 text-center text-slate-700 dark:border-slate-600 dark:bg-slate-800 dark:text-slate-200"
            data-theme-preview
            data-theme-light-icon="mdi mdi-white-balance-sunny text-4xl text-amber-500"
            data-theme-light-title="{{ _('Hello from light mode!') }}"
            data-theme-light-description="{{ _('Sunlit surfaces keep details crisp and colorful.') }}"
            data-theme-dark-icon="mdi mdi-weather-night text-4xl text-blue-400"
            data-theme-dark-title="{{ _('Hello from dark mode!') }}"
            data-theme-dark-description="{{ _('If you switch back to light mode, this preview will lighten up automatically.') }}"
        >
            <span class="mdi mdi-weather-night text-4xl text-blue-400" data-theme-preview-icon></span>
            <p class="mt-4 font-medium" data-theme-preview-title>
                {{ _('Hello from dark mode!') }}
            </p>
            <p class="text-sm text-slate-600 dark:text-slate-300" data-theme-preview-description>
                {{ _('If you switch back to light mode, this preview will lighten up automatically.') }}
            </p>
        </div>
    </article>

    <article class="rounded-xl border border-slate-200 bg-white/80 p-6 shadow-sm transition-colors dark:border-slate-700 dark:bg-slate-900/70">
        <div class="flex items-center justify-between gap-4">
            <div class="flex items-center gap-2">
                <span class="mdi mdi-star-circle-outline text-blue-600 text-2xl dark:text-blue-400"></span>
                <h2 class="text-xl font-semibold text-slate-900 dark:text-slate-100">
                    {{ _('Favorite projects') }}
                </h2>
            </div>
        </div>
        <p class="mt-2 text-sm text-slate-600 dark:text-slate-300">
            {{ _('Quick access to the projects you reach for most often.') }}
        </p>
        {% if favorites %}
        <ul class="mt-6 space-y-4">
            {% for project in favorites %}
            <li class="rounded-lg border border-slate-200 bg-white/70 p-4 shadow-sm transition hover:border-blue-300 hover:shadow-md dark:border-slate-700 dark:bg-slate-900/60 dark:hover:border-blue-500" data-favorite-item>
                <div class="flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
                    <div>
                        <p class="text-lg font-semibold text-slate-900 dark:text-slate-100 flex items-center gap-2">
                            <span class="mdi mdi-text-box-outline text-blue-500 dark:text-blue-300"></span>
                            {{ project.name }}
                        </p>
                        <p class="text-sm text-slate-500 dark:text-slate-300">
                            {{ _('Last updated on %(date)s', date=project.updated_at.strftime('%Y-%m-%d')) }}
                        </p>
                    </div>
                    <div class="flex gap-2">
                        <a
                            href="/projects/{{ project.id }}"
                            class="inline-flex items-center gap-2 rounded-md bg-blue-50 px-3 py-2 text-sm font-medium text-blue-700 transition hover:bg-blue-100 focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-blue-400/10 dark:text-blue-300 dark:hover:bg-blue-400/20"
                        >
                            <span class="mdi mdi-eye-outline"></span>
                            {{ _('View project') }}
                        </a>
                        <button
                            type="button"
                            hx-delete="/projects/{{ project.id }}/favorite?variant=profile"
                            hx-target="closest [data-favorite-item]"
                            hx-swap="outerHTML"
                            hx-on::after-request="if (event.detail.successful) { showToast('{{ _('Removed from favorites') }}', 'info'); }"
                            class="inline-flex items-center gap-2 rounded-md bg-red-50 px-3 py-2 text-sm font-medium text-red-600 transition hover:bg-red-100 focus:outline-none focus:ring-2 focus:ring-red-500 dark:bg-red-400/10 dark:text-red-300 dark:hover:bg-red-400/20"
                        >
                            <span class="mdi mdi-star-off-outline"></span>
                            {{ _('Remove') }}
                        </button>
                    </div>
                </div>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <div class="mt-6 rounded-lg border border-dashed border-slate-300 p-6 text-center text-slate-500 dark:border-slate-600 dark:text-slate-300">
            <span class="mdi mdi-star-outline text-4xl"></span>
            <p class="mt-3 font-medium">{{ _('You have not favorited any projects yet.') }}</p>
            <p class="text-sm">{{ _('Visit a project to add it to your favorites list.') }}</p>
        </div>
        {% endif %}
    </article>
</section>
{% endblock %}
