{% extends "base.html" %}

{% block title %}{{ _('Manage Categories') }} - Stricknani{% endblock %}

{% block content %}
<div class="mb-6">
    <a href="/projects" class="text-blue-600 hover:text-blue-800 inline-flex items-center gap-2 dark:text-blue-400 dark:hover:text-blue-300">
        <span class="mdi mdi-arrow-left"></span>
        {{ _('Back to Projects') }}
    </a>
</div>

<div class="max-w-4xl mx-auto space-y-8">
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-3xl font-bold text-slate-900 dark:text-slate-100 flex items-center gap-2">
                <span class="mdi mdi-shape-outline text-blue-600 dark:text-blue-400"></span>
                {{ _('Manage Categories') }}
            </h1>
            <p class="mt-2 text-slate-600 dark:text-slate-300">
                {{ _('Create, rename, or remove project categories.') }}
            </p>
        </div>
    </div>

    {% if message %}
    <div class="rounded-md bg-green-50 p-4 dark:bg-green-900/30">
        <div class="flex">
            <div class="flex-shrink-0">
                <span class="mdi mdi-check-circle text-green-400"></span>
            </div>
            <div class="ml-3">
                <p class="text-sm font-medium text-green-800 dark:text-green-200">{{ message }}</p>
            </div>
        </div>
    </div>
    {% endif %}

    {% if error %}
    <div class="rounded-md bg-red-50 p-4 dark:bg-red-900/30">
        <div class="flex">
            <div class="flex-shrink-0">
                <span class="mdi mdi-alert-circle text-red-400"></span>
            </div>
            <div class="ml-3">
                <p class="text-sm font-medium text-red-800 dark:text-red-200">{{ error }}</p>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Create New Category -->
    <div class="bg-white/80 rounded-lg shadow-md p-6 backdrop-blur dark:bg-slate-900/80 dark:shadow-slate-900/30">
        <h2 class="text-lg font-semibold text-slate-900 mb-4 dark:text-slate-100">{{ _('Add New Category') }}</h2>
        <form action="/projects/categories" method="post" class="flex gap-4">
            <div class="flex-grow">
                <label for="new-category-name" class="sr-only">{{ _('Category Name') }}</label>
                <input
                    type="text"
                    id="new-category-name"
                    name="name"
                    required
                    placeholder="{{ _('e.g., Socks, Shawl, Amigurumi') }}"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100"
                >
            </div>
            <button
                type="submit"
                class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors inline-flex items-center gap-2 dark:hover:bg-blue-500 whitespace-nowrap"
            >
                <span class="mdi mdi-plus"></span>
                {{ _('Create') }}
            </button>
        </form>
    </div>

    <!-- Category List -->
    <div class="bg-white/80 rounded-lg shadow-md overflow-hidden backdrop-blur dark:bg-slate-900/80 dark:shadow-slate-900/30">
        <div class="px-6 py-4 border-b border-slate-200 dark:border-slate-700">
            <h2 class="text-lg font-semibold text-slate-900 dark:text-slate-100">{{ _('Your Categories') }}</h2>
        </div>
        <ul class="divide-y divide-slate-200 dark:divide-slate-700">
            {% for category in categories %}
            <li class="p-6 hover:bg-slate-50 transition-colors dark:hover:bg-slate-800/50">
                <form action="/projects/categories/{{ category.id }}" method="post" class="flex items-center justify-between gap-4">
                    <div class="flex-grow">
                        <label for="category-{{ category.id }}" class="sr-only">{{ _('Category Name') }}</label>
                        <input
                            type="text"
                            id="category-{{ category.id }}"
                            name="name"
                            value="{{ category.name }}"
                            required
                            class="w-full max-w-sm px-3 py-2 border border-transparent bg-transparent hover:border-gray-300 hover:bg-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all dark:hover:border-slate-600 dark:hover:bg-slate-900 dark:focus:bg-slate-900 dark:text-slate-100"
                        >
                        <p class="text-xs text-slate-500 mt-1 dark:text-slate-400">
                            {{ ngettext('%(num)d project', '%(num)d projects', category.project_count) % {'num': category.project_count} }}
                        </p>
                    </div>
                    <div class="flex items-center gap-2">
                        <button
                            type="submit"
                            class="text-slate-400 hover:text-blue-600 p-2 rounded-md hover:bg-blue-50 transition-colors dark:hover:text-blue-400 dark:hover:bg-blue-500/10"
                            title="{{ _('Save changes') }}"
                        >
                            <span class="mdi mdi-content-save-outline text-xl"></span>
                        </button>
                        {% if category.project_count == 0 %}
                        <button
                            type="submit"
                            formaction="/projects/categories/{{ category.id }}/delete"
                            onclick="return confirm('{{ _('Are you sure you want to delete this category?') }}')"
                            class="text-slate-400 hover:text-red-600 p-2 rounded-md hover:bg-red-50 transition-colors dark:hover:text-red-400 dark:hover:bg-red-500/10"
                            title="{{ _('Delete category') }}"
                        >
                            <span class="mdi mdi-trash-can-outline text-xl"></span>
                        </button>
                        {% else %}
                        <span
                            class="text-slate-300 p-2 cursor-not-allowed dark:text-slate-600"
                            title="{{ _('Cannot delete category with associated projects') }}"
                        >
                            <span class="mdi mdi-trash-can-outline text-xl"></span>
                        </span>
                        {% endif %}
                    </div>
                </form>
            </li>
            {% else %}
            <li class="p-8 text-center text-slate-500 dark:text-slate-400">
                <span class="mdi mdi-shape-plus text-4xl mb-2 block text-slate-300 dark:text-slate-600"></span>
                {{ _('You have no custom categories yet.') }}
            </li>
            {% endfor %}
        </ul>
    </div>
</div>
{% endblock %}
